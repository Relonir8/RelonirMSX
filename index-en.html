<!DOCTYPE html>
<html>
<head>
    <title>Vidaa App Store</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
    <meta name="viewport" content="width=device-width, height=device-height">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>  
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.js"></script>
	<link rel="stylesheet" href="style.css">
<script type="text/javascript">  
console.log("loaded");
var cdn = 'https://ttv.w00t.fyi/store/img/';
/*
*  Feel free to add your custom HTML5 applications in the following format:
*    appid:'appid'   - any unique ID of the application on your Vidaa device
*    name:'name'     - name of the application on your Vidaa device. I suppose it also better to have it unique
*    url:'http://'   - any website in the internet which supports Smart TV devices. Use HTTP or HTTPS (if supported by the website)
*    text:'Application description' - Any text, description of the application
*    category: 'category_name'      - Any category name.. or the tag. I use it only for grouping the applications. Wanted to customize this "store" and sort the applications using JS and category name.
*/
var apps = [
/* Lampa and it's forks */
	{category:'lampa',appid:'vidaa_lampa',name:'Lampa',url:'http://lampa.mx/',text:'Lampa.mx - Media catalog for Smart TV (https://github.com/yumata/lampa-source/)'},
	{category:'lampa',appid:'vidaa_showy',name:'Showy',url:'https://showy.online/',text:'Showy - Alternative hosting of Lampa'},
	{category:'lampa',appid:'vidaa_lampalite4',name:'Lampa lite',url:'http://lite.lampa.mx/',text:'Lampa Lite.mx, light version of Lampa'},
	{category:'lampa',appid:'vidaa_prisma',name:'Prisma',url:'http://prisma.ws/',text:'Prisma - One more fork of Lampa'},
/* Players */
	{category:'players',appid:'vidaa_fxml',name:'Media Station X',url:'https://msx.benzac.de/foxxum.html',text:'Media Station X'},
	{category:'players',appid:'vidaa_msx',name:'MSXPlayer',url:'https://msx.benzac.de/?welcome=menu:request:interaction:menu@http://plugins.msxplayer.ru/store.html',text:'MSX Player: TorrServer-client, FXML-browser, IPTV-player'},
	{category:'players',appid:'vidaa_fork',name:'ForkPlayer',url:'http://browser.appfxml.com/',text:'ForkPlayer'},
/* A few my favourite sites */
	{category:'my',appid:'vidaa_windy',name:'Windy',url:'https://www.windy.com/',text:'Windy'},

/* Players and Launchers */
	{category:'players',appid:'vidaa_oneplayer',name:'Oneplayer',url:'http://webos.oneplayer.me/',text:'OnePlayer'},
	{category:'players',appid:'vidaa_drmplay',name:'DRM-play',url:'http://drm-play.com',text:'OttPlayer drm-play mod'},
	{category:'players',appid:'vidaa_ott',name:'OttPlayer',url:'http://widget.ottplayer.tv/operatv2/index.html',text:'OttPlayer'},
	{category:'players',appid:'vidaa_ottold',name:'OttPlayerTest',url:'http://widget.ottplayer.tv/test/index.html',text:'OttPlayer - Test'},
	{category:'players',appid:'vidaa_xsmart',name:'Xsmart',url:'http://app.xsmart.tv/?widg=5',text:'XSmart'},
	{category:'players',appid:'vidaa_xsmartlite',name:'Xsmart classic',url:'http://app.xsmart.tv/?widg=lite',text:'XSmart Lite'},
	{category:'players',appid:'vidaa_forkbeta',name:'ForkPlayer Beta',url:'http://browser.appinfo.su/',text:'ForkPlayer alternative'},
	{category:'players',appid:'vidaa_clouddy',name:'ClouDDy',url:'http://player.clouddy.online/',text:'ClouDDy'},
	{category:'players',appid:'vidaa_webvideocast2',name:'Web Video Cast',url:'http://vewd.webvideocaster.com/',text:'Web Video Cast'},
/* Twitch an other "officially" supported applications by their vendors */
	{category:'official',appid:'vidaa_twitch',name:'twitch',url:'https://hisense.tv.twitch.tv/',text:'Twitch'},
	{category:'official',appid:'vidaa_vevo',name:'Vevo',url:'https://hisense.vevo.com',text:'Vevo'},
	{category:'official',appid:'vidaa_emby',name:'Emby',url:'http://tv.emby.media/',text:'Emby - Media server and home cinema'},
/* IPTV */	
	{category:'iptv',appid:'vidaa_tvap',name:'TVap',url:'http://tvphone.site/',text:'TVap - IPTV player for Smart TV'},
	{category:'iptv',appid:'vidaa_icva',name:'ICVA',url:'http://icva.mx/',text:'ICVA - IPTV player'},
	{category:'iptv',appid:'vidaa_siptv',name:'Smart IPTV',url:'http://opera.siptv.eu',text:'Play IPTV streams, videos on your Smart TV'},
/* Music */
	{category:'music',appid:'vidaa_mytuner',name:'myTuner Radio',url:'https://devices.mytuner.mobi/?utm_source=Foxxum',text:'myTiner Radio - listen to 30 000 radio stations from 120 countries'},
/* Regional */

/* The next category - I wanted to install on my Hisense TV, but it doesn't support Smart TV :) 
   Welcome to contribute!
*/
/*
	{category:'my',appid:'vidaa_google_photo',name:'Google Photos',url:'https://photos.google.com/',text:'Google Photos'},
	{category:'my',appid:'vidaa_acuweather',name:'Acuweather',url:'https://www.accuweather.com/',text:'AcuWeather'},
	{category:'my',appid:'vidaa_yahoo_weather',name:'Yahoo! Weather',url:'https://www.yahoo.com/news/weather/',text:'Yahoo! Weather'},
	{category:'music',appid:'vidaa_spotify',name:'Spotify',url:'https://open.spotify.com/',text:'Spotify'},
*/
];

$(document).ready(function () {
    // Удаляем дублирующиеся приложения
    const uniqueApps = Array.from(new Set(apps.map(a => a.appid)))
        .map(id => apps.find(a => a.appid === id));

    let result = "";

    uniqueApps.forEach((app) => {
        const icon = app.icon ? app.icon : `${cdn}${app.appid}.png`;

        result += `
            <div class="cell">
                <div class="cell-img" style="background-image: url('${icon}');">
                    <div class="tooltip">
                        <div class="description">${app.text || "Описание недоступно"}</div>
                        <div class="buttons">
                            <button class="install" onclick="installHisense('${app.appid}')">Install</button>
                            <button class="uninstall" onclick="uninstallHisense('${app.appid}')">Uninstall</button>
                        </div>
                    </div>
                </div>
                <div class="appname">${app.name || "Unknown App"}</div>
            </div>
        `;
    });

    // Очищаем содержимое таблицы перед добавлением
    $("#table").html(result);
});

function installHisense(appid) {
	$("#result").html("<br/>Попытка установки "+appid+"<br/>"+"<br/>----<br/>"+$("#result").html());
	if (typeof  Hisense_GetCountryCode == 'function') {
	// Check if this running on Hisense TV: Hisense_GetCountryCode should be available
	//**** Try install
		apps.forEach(function(currentValue, index){
			if (currentValue['appid'] == appid) {
				var v_application_node = currentValue;
				var v_application_str = v_application_node['name'] + 'debug';
				var v_image_url = cdn + v_application_node['appid'] + '.png';
				var v_image_url = (v_application_node['icon'] && v_application_node['icon'].length > 10)?v_application_node['icon']:cdn + v_application_node['appid']+".png";
				var v_store = 'store';
				try {
					$("#result").html(
						"> Установка приложения "+v_application_node['name']+"<br/>"
					);
					Hisense_installApp(
						v_application_str, 
						v_application_node['name'], 
						v_image_url, v_image_url, v_image_url, 
						v_application_node['url'], 
						v_store, 
						function(status) {
							status ? 
								$("#result").html(
									"> Установка не удалась 1 :(<br/>"+
									$("#result").html()
								)
								: 
								(
									$("#result").html(
									"> Приложение успешно установлено<br/>"+
									$("#result").html()
									),
									refreshAppsOnHisenseUI(v_application_str)
								);
						}
					);
				} catch (event) {
					$("#result").html(
						"> Installation failed 2<br/>"+
						event+
						$("#result").html()
					);
				}
			}
		// end of foreach
		});
	} else {
	// end of if Hisense_GetCountryCode
		// not hisense
		apps.forEach(function(currentValue, index){
			if (currentValue['appid'] == appid) {
				$("#result").html(
					"> Hisense не был обнаружен. Приложение "+currentValue['appid']+" приложение не устанавливается<br/>"+
					$("#result").html()
				);
			}
		});
	}
}
function uninstallHisense(appid) {
	$("#result").html("<br/>Попытка деинсталляции "+appid+"<br/>"+"<br/>----<br/>"+$("#result").html());
	if (typeof  Hisense_GetCountryCode == 'function') {
	// Check if this running on Hisense TV: Hisense_GetCountryCode should be available
	//**** Try uninstall
		apps.forEach(function(currentValue, index){
			if (currentValue['appid'] == appid) {
				var v_application_node = currentValue;
				var v_application_str = v_application_node['name'] + 'debug';
				try {
					Hisense_uninstallApp(
						v_application_str, 
						function(status) {
							!status ? 
								$("#result").html(
									"> Не удалось выполнить переустановку 1 :(<br/>"+
									$("#result").html()
								)
								: 
								(
									$("#result").html(
										"> Деинсталляция завершена, "+v_application_node['name']+" удаление прошло успешно<br/>"+
										$("#result").html()
									),
									refreshAppsOnHisenseUI()
								);
						}
					);
				} catch (event) {
					$("#result").html(
						"> Деинсталляция не удалась 2 :(" + event+"<br/>"+
						$("#result").html()
					);
				}
			}
		// end of foreach
		});
	} else {
	// end of if Hisense_GetCountryCode
		// not hisense
		apps.forEach(function(currentValue, index){
			if (currentValue['appid'] == appid) {
				$("#result").html(
					"> Hisense не был обнаружен. Приложение "+currentValue['appid']+" не может быть удалено<br/>"+
					$("#result").html()
				);
			}
		});
	}
}
function refreshAppsOnHisenseUI(v_app_info) {
    var v_refresh_message = {};
    v_refresh_message['type'] = 'APPMessage', 
		v_refresh_message['MsgType'] = 'appControl', 
		v_refresh_message['action'] = 'updateAppState', 
		v_refresh_message['source'] = 'browser', 
		v_refresh_message['startAppType'] = 0x2, 
		v_refresh_message['param'] = {
			'event': 'AllAppsUpdate',
			'SubModuleName': 'AllApps',
			'startFrom': '',
			'appInfo': v_app_info
		};
    if (!!window['omi_platform']) omi_platform['sendPlatformMessage'](JSON['stringify'](v_refresh_message));
    else !!window['opera_omi'] && opera_omi['sendPlatformMessage'](JSON['stringify'](v_refresh_message));
}
function testHisense() {
	$("#result").html("<br/>Попытка собрать информацию о телевизоре Hisense<br/>"+"<br/>----<br/>"+$("#result").html());
	if (typeof  Hisense_GetCountryCode == 'function') {
		$("#result").html(
			"> Hisense_GetCountryCode: "+ Hisense_GetCountryCode() + "<br/>"+
			"> Hisense_GetDeviceID: "+ Hisense_GetDeviceID() + "<br/>"+
			"> Hisense_GetBrand: "+ Hisense_GetBrand() + "<br/>"+
			"> Hisense_GetModelName: "+ Hisense_GetModelName() + "<br/>"+
			"> Hisense_GetFirmWareVersion: "+ Hisense_GetFirmWareVersion() + "<br/>"+
			"> Hisense_GetMacAddress: "+ Hisense_GetMacAddress() + "<br/>"+
			$("#result").html()
		  );
		 if (typeof Hisense_installApp == 'function') {
			$("#result").html(
				"> Доступна функция Hisense_installApp. Вы можете установить приложения<br/>"+
				$("#result").html()
			);
		 } else {
			$("#result").html(
				"> Hisense_installApp недоступен, убедитесь, что вы изменили DNS-сервер и открыли этот сайт с URL vidaahub.com<br/>"+
				$("#result").html()
			);
		 }
	} else {
		$("#result").html(
			"> Hisense_GetCountryCode недоступен, убедитесь, что вы открыли эту страницу на телевизоре Hisense<br/>"+
			$("#result").html()
		);
	}
}
</script>

<script type="text/javascript">

//*/
</script>
<div class="mw-parser-output">
<div id="table-main">
<div id="table">&nbsp;</div>
</div>
<div style="margin:20px;text-align:center;" >
<a href="javascript:void(0);" onclick="testHisense();">Test Hisense</a>
</div>
<div id="result">&nbsp;<br/></div>
</div>
</body>
</html>
